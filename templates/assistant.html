<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alligator.tour - AI Travel Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --alligator-green: #4C8C4A;
            --alligator-dark-green: #2A5A28;
            --alligator-teal: #35B0B7;
            --alligator-light-teal: #8DD7DB;
            --alligator-black: #222222;
            --alligator-gray: #F5F5F5;
            --alligator-white: #FFFFFF;
            --main-font: 'Poppins', sans-serif;
            --heading-font: 'Montserrat', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--main-font);
            color: #333;
            background-color: var(--alligator-white);
            line-height: 1.6;
            overflow-x: hidden;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .page-wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            padding: 0;
            color: white;
            text-align: center;
            position: relative;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .logo-section {
            background-color: white;
            width: 100%;
            padding: 20px 0;
        }

        .logo {
            width: 180px;
            height: auto;
            margin-bottom: 10px;
            background-color: white;
        }

        .header-content {
            background: linear-gradient(135deg, var(--alligator-green) 0%, var(--alligator-teal) 100%);
            padding: 30px 0;
        }

        .tagline {
            font-family: var(--heading-font);
            font-weight: 600;
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: white;
        }

        .subtitle {
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.9;
            color: white;
        }

        /* Language Selector - Complete rewrite */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            font-family: var(--main-font);
        }

        .language-button {
            background-color: white;
            color: var(--alligator-dark-green);
            border: 2px solid var(--alligator-green);
            border-radius: 30px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 120px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .language-button:hover {
            background-color: #f9f9f9;
        }

        .language-button i {
            margin-left: 10px;
            color: var(--alligator-green);
            transition: transform 0.2s ease;
        }

        .language-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 8px 0;
            width: 140px;
            display: none;
        }
        
        .language-menu.active {
            display: block;
        }

        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: var(--alligator-dark-green);
        }

        .language-option:hover {
            background-color: #f5f5f5;
        }

        .language-option.selected {
            font-weight: 600;
            background-color: #f0f0f0;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 50px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Chat Container - Wider and centered */
        .chat-section {
            display: grid;
            grid-template-columns: 1fr 3fr; /* Changed from 1fr 2fr to make chat wider */
            gap: 50px;
            margin-bottom: 60px;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto 60px;
        }

        .chat-intro {
            max-width: 600px; /* Increased from 500px */
        }

        .chat-intro h2 {
            font-family: var(--heading-font);
            font-weight: 700;
            font-size: 2.2rem;
            color: var(--alligator-dark-green);
            margin-bottom: 20px;
            word-wrap: break-word;
        }

        .chat-intro p {
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #555;
            word-wrap: break-word;
        }

        .feature-list {
            margin-bottom: 30px;
            width: 100%;
        }

        .feature-item {
            display: flex;
            align-items: flex-start; /* Changed from center to align-items: flex-start */
            margin-bottom: 15px;
            width: 100%;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background-color: #E8F5E9;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            flex-shrink: 0;
            margin-top: 3px; /* Added to align better with top of text */
        }

        .feature-icon i {
            color: var(--alligator-green);
            font-size: 18px;
        }

        .feature-text {
            font-size: 1rem;
            color: #444;
            flex: 1;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .chat-container-wrapper {
            position: relative;
            width: 100%;
        }

        .chat-container {
            width: 100%;
            max-width: 800px; /* Increased from 600px */
            height: 650px;
            background-color: var(--alligator-white);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            margin: 0 auto; /* Ensure it's centered */
        }

        .chat-header {
            background: linear-gradient(to right, var(--alligator-green), var(--alligator-teal));
            color: var(--alligator-white);
            padding: 20px;
            display: flex;
            align-items: center;
        }

        .chat-header img {
            width: 40px;
            height: 40px;
            margin-right: 15px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-header-info h3 {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .chat-header-info p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background-color: #f9f9f9;
        }

        .message {
            max-width: 80%;
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            animation: messageIn 0.3s ease;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .message.assistant {
            align-self: flex-start;
            background-color: #E8F5E9;
            border-top-left-radius: 4px;
            border-left: 3px solid var(--alligator-green);
            color: #333;
        }

        .message.user {
            align-self: flex-end;
            background-color: #E3F2FD;
            border-top-right-radius: 4px;
            text-align: right;
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 15px;
            width: auto;
            max-width: 100px;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            float: left;
            margin: 0 1px;
            background-color: var(--alligator-green);
            display: block;
            border-radius: 50%;
            opacity: 0.4;
        }

        .typing-indicator span:nth-of-type(1) {
            animation: 1s blink infinite 0.3333s;
        }

        .typing-indicator span:nth-of-type(2) {
            animation: 1s blink infinite 0.6666s;
        }

        .typing-indicator span:nth-of-type(3) {
            animation: 1s blink infinite 0.9999s;
        }

        @keyframes blink {
            50% {
                opacity: 1;
            }
        }

        .chat-input {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            background-color: white;
        }

        .chat-input input {
            flex: 1;
            border: none;
            background-color: var(--alligator-gray);
            padding: 12px 20px;
            border-radius: 30px;
            font-size: 0.95rem;
            outline: none;
            transition: box-shadow 0.3s ease;
            font-family: var(--main-font);
        }

        .chat-input input:focus {
            box-shadow: 0 0 0 2px rgba(76, 140, 74, 0.2);
        }

        .send-btn {
            background-color: var(--alligator-green);
            color: var(--alligator-white);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .send-btn:hover {
            background-color: var(--alligator-dark-green);
        }

        /* Popular Destinations Section */
        .destinations-section {
            width: 100%;
            padding: 40px 0;
            background-color: white;
            border-radius: 20px;
            margin-bottom: 60px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-family: var(--heading-font);
            font-weight: 700;
            font-size: 2rem;
            color: var(--alligator-dark-green);
            margin-bottom: 15px;
        }

        .section-header p {
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
            color: #555;
        }

        .destinations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 0 20px;
        }

        .destination-card {
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .destination-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .destination-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .destination-content {
            padding: 20px;
        }

        .destination-title {
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--alligator-dark-green);
            margin-bottom: 10px;
        }

        .destination-desc {
            color: #555;
            margin-bottom: 15px;
        }

        .destination-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .best-time {
            font-size: 0.85rem;
            display: flex;
            align-items: center;
        }

        .best-time i {
            color: var(--alligator-green);
            margin-right: 5px;
        }

        .explore-btn {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--alligator-teal);
            display: flex;
            align-items: center;
        }

        .explore-btn i {
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .explore-btn:hover i {
            transform: translateX(3px);
        }

        /* CTA Section */
        .cta-section {
            text-align: center;
            background: linear-gradient(135deg, var(--alligator-teal) 0%, var(--alligator-green) 100%);
            color: white;
            padding: 60px 30px;
            border-radius: 20px;
            margin-bottom: 60px;
        }

        .cta-section h2 {
            font-family: var(--heading-font);
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .cta-section p {
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }

        .cta-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .btn {
            display: inline-block;
            background-color: var(--alligator-white);
            color: var(--alligator-dark-green);
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--alligator-white);
            color: var(--alligator-white);
        }

        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Footer */
        footer {
            background-color: var(--alligator-white);
            padding: 30px 0;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .social-icon {
            width: 42px;
            height: 42px;
            background-color: var(--alligator-gray);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            color: var(--alligator-dark-green);
            font-size: 1.2rem;
        }

        .social-icon:hover {
            background-color: var(--alligator-green);
            color: white;
            transform: translateY(-3px);
        }

        .copyright {
            font-size: 0.9rem;
            color: #777;
        }

        /* Animation for messages */
        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .chat-section {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .chat-intro {
                max-width: 100%;
                text-align: center;
                padding: 0 20px; /* Added padding on mobile */
            }
            
            .feature-item {
                justify-content: flex-start; /* Changed from center */
                text-align: left;
                padding: 0 10px; /* Added padding for mobile */
            }
            
            .chat-container {
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .destinations-grid {
                grid-template-columns: 1fr;
                max-width: 500px;
                margin: 0 auto;
            }
            
            .cta-buttons {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                width: 140px;
            }
            
            .tagline {
                font-size: 1.3rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .chat-intro h2 {
                font-size: 1.8rem;
            }
            
            .section-header h2 {
                font-size: 1.8rem;
            }
            
            .cta-section h2 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- Header with Logo -->
        <header>
            <div class="language-selector">
                <div class="language-button">
                    <span>{{ lang_name }}</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="language-menu">
                    {% for code, name in supported_languages.items() %}
                        <div class="language-option {% if code == lang %}selected{% endif %}" data-lang="{{ code }}">{{ name }}</div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="logo-section">
                <div class="container">
                    <div class="logo-container">
                        <img src="/static/images/logo.png" alt="Alligator Tour Logo" class="logo">
                    </div>
                </div>
            </div>
            
            <div class="header-content">
                <div class="container">
                    <h1 class="tagline">{{ translations[lang].title }}</h1>
                    <p class="subtitle">{{ translations[lang].subtitle }}</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Chat Section with Intro -->
                <section class="chat-section">
                    <div class="chat-intro">
                        <h2 class="chat-intro-title">{{ translations[lang].chat_intro.title }}</h2>
                        <p class="chat-intro-description">{{ translations[lang].chat_intro.description }}</p>
                        
                        <div class="feature-list">
                            <div class="feature-item">
                                <div class="feature-icon">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <div class="feature-text feature-destinations">
                                    {{ translations[lang].features.destinations }}
                                </div>
                            </div>
                            
                            <div class="feature-item">
                                <div class="feature-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="feature-text feature-languages">
                                    {{ translations[lang].features.languages }}
                                </div>
                            </div>
                            
                            <div class="feature-item">
                                <div class="feature-icon">
                                    <i class="fas fa-route"></i>
                                </div>
                                <div class="feature-text feature-itineraries">
                                    {{ translations[lang].features.itineraries }}
                                </div>
                            </div>
                            
                            <div class="feature-item">
                                <div class="feature-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="feature-text feature-availability">
                                    {{ translations[lang].features.availability }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-container-wrapper">
                        <div class="chat-container">
                            <div class="chat-header">
                                <img src="/static/images/avatar.png" alt="Alligator Tour Assistant">
                                <div class="chat-header-info">
                                    <h3 class="chat-header-title">{{ translations[lang].chat_header.title }}</h3>
                                    <p class="chat-header-status">{{ translations[lang].chat_header.status }}</p>
                                </div>
                            </div>
                            
                            <div class="chat-messages">
                                <div class="message assistant">
                                    {{ welcome_message|safe }}
                                </div>
                            </div>
                            
                            <div class="chat-input">
                                <input type="text" placeholder="{{ translations[lang].input_placeholder }}">
                                <div class="send-btn">
                                    <i class="fas fa-paper-plane"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Popular Destinations Section -->
                <section class="destinations-section">
                    <div class="section-header">
                        <h2 class="destinations-heading">{{ translations[lang].popular_destinations }}</h2>
                        <p class="destinations-description">{{ translations[lang].destinations_description }}</p>
                    </div>
                    
                    <div class="destinations-grid">
                        <!-- Bali -->
                        <div class="destination-card">
                            <img src="/static/images/bali.png" alt="Bali" class="destination-img">
                            <div class="destination-content">
                                <h3 class="destination-title">{{ translations[lang].destinations.bali.name }}</h3>
                                <p class="destination-desc">{{ translations[lang].destinations.bali.description }}</p>
                                <div class="destination-footer">
                                    <div class="best-time">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span>{{ translations[lang].destinations.bali.best_time }}</span>
                                    </div>
                                    <a href="#" class="explore-btn">
                                        <span>{{ translations[lang].destinations.bali.explore }}</span>
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Barcelona -->
                        <div class="destination-card">
                            <img src="/static/images/barcelona.png" alt="Barcelona" class="destination-img">
                            <div class="destination-content">
                                <h3 class="destination-title">{{ translations[lang].destinations.barcelona.name }}</h3>
                                <p class="destination-desc">{{ translations[lang].destinations.barcelona.description }}</p>
                                <div class="destination-footer">
                                    <div class="best-time">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span>{{ translations[lang].destinations.barcelona.best_time }}</span>
                                    </div>
                                    <a href="#" class="explore-btn">
                                        <span>{{ translations[lang].destinations.barcelona.explore }}</span>
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tokyo -->
                        <div class="destination-card">
                            <img src="/static/images/tokyo.png" alt="Tokyo" class="destination-img">
                            <div class="destination-content">
                                <h3 class="destination-title">{{ translations[lang].destinations.tokyo.name }}</h3>
                                <p class="destination-desc">{{ translations[lang].destinations.tokyo.description }}</p>
                                <div class="destination-footer">
                                    <div class="best-time">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span>{{ translations[lang].destinations.tokyo.best_time }}</span>
                                    </div>
                                    <a href="#" class="explore-btn">
                                        <span>{{ translations[lang].destinations.tokyo.explore }}</span>
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Call to Action Section -->
                <section class="cta-section">
                    <h2>{{ translations[lang].cta.title }}</h2>
                    <p>{{ translations[lang].cta.description }}</p>
                    <div class="cta-buttons">
                        <a href="https://t.me/+380967200256" class="btn" target="_blank" rel="noopener">{{ translations[lang].cta.contact }}</a>
                        <a href="https://www.alligatortour.com.ua/" class="btn btn-outline" target="_blank" rel="noopener">{{ translations[lang].cta.view_packages }}</a>
                    </div>
                </section>
            </div>
        </main>
        
        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="social-links">
                    <a href="https://www.instagram.com/alligatortour" class="social-icon" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>
                    <a href="mailto:alligatoravia@gmail.com" class="social-icon" target="_blank" rel="noopener"><i class="far fa-envelope"></i></a>
                    <a href="https://t.me/+380967200256" class="social-icon" target="_blank" rel="noopener"><i class="fab fa-telegram"></i></a>
                    <a href="tel:+380967200256" class="social-icon" target="_blank" rel="noopener"><i class="fas fa-phone"></i></a>
                </div>
                
                <p class="copyright">&copy; {{ current_year }} Alligator Tour</p>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // Store session info
        let sessionId = localStorage.getItem('alligator_session_id') || generateSessionId();
        
        // Check if this is the first visit or if the language preference was already set
        const hasVisitedBefore = localStorage.getItem('alligator_has_visited_before');
        
        // If it's the first visit, set the language to Ukrainian
        if (!hasVisitedBefore) {
            localStorage.setItem('alligator_preferred_lang', "uk");
            localStorage.setItem('alligator_has_visited_before', 'true');
        }
        
        let currentLang = localStorage.getItem('alligator_preferred_lang') || "uk";
        let userInfo = JSON.parse(localStorage.getItem('alligator_user_info') || '{}');
        let translations = {};
        
        // Save session ID in local storage
        localStorage.setItem('alligator_session_id', sessionId);
        // Save preferred language
        localStorage.setItem('alligator_preferred_lang', currentLang);
        
        // Generate a random session ID
        function generateSessionId() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        // Language selector - completely rewritten
        document.addEventListener('DOMContentLoaded', function() {
            // Get language selector elements
            const languageButton = document.querySelector('.language-button');
            const languageMenu = document.querySelector('.language-menu');
            const languageOptions = document.querySelectorAll('.language-option');
            
            // Check if we need to redirect to the saved language if different from current
            if (currentLang !== "{{ lang }}") {
                // Redirect to the page with the saved language
                window.location.href = `/?lang=${currentLang}`;
                return;
            }
            
            // Load translations
            fetch('/static/translations.json')
                .then(response => response.json())
                .then(data => {
                    translations = data;
                    // Initial translation for destinations and CTA (in case server-side templates didn't catch everything)
                    updateDestinationsAndCTA(currentLang);
                })
                .catch(error => {
                    console.error('Error loading translations:', error);
                });
            
            // Toggle menu when button is clicked
            languageButton.addEventListener('click', function(e) {
                e.stopPropagation();
                languageMenu.classList.toggle('active');
                
                // Change arrow direction
                const arrow = languageButton.querySelector('i');
                if (languageMenu.classList.contains('active')) {
                    arrow.style.transform = 'rotate(180deg)';
                } else {
                    arrow.style.transform = 'rotate(0)';
                }
            });
            
            // Handle language selection
            languageOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    const newLang = this.getAttribute('data-lang');
                    if (newLang === currentLang) {
                        // Just close the menu if selecting the current language
                        languageMenu.classList.remove('active');
                        languageButton.querySelector('i').style.transform = 'rotate(0)';
                        return;
                    }
                    
                    // Change language via API
                    fetch('/api/language', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ lang: newLang }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Update current language
                            currentLang = newLang;
                            
                            // Save language preference in local storage
                            localStorage.setItem('alligator_preferred_lang', currentLang);
                            
                            // Update selected states
                            languageOptions.forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            this.classList.add('selected');
                            
                            // Update button text
                            languageButton.querySelector('span').textContent = this.textContent;
                            
                            // Update UI language
                            updateUILanguage(newLang, data.welcome_message);
                            
                            // Close the menu
                            languageMenu.classList.remove('active');
                            languageButton.querySelector('i').style.transform = 'rotate(0)';
                        }
                    })
                    .catch(error => {
                        console.error('Error changing language:', error);
                    });
                });
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function() {
                languageMenu.classList.remove('active');
                languageButton.querySelector('i').style.transform = 'rotate(0)';
            });
        });
        
        // Chat functionality
        const sendBtn = document.querySelector('.send-btn');
        const chatInput = document.querySelector('.chat-input input');
        const chatMessages = document.querySelector('.chat-messages');
        
        // Send message when button is clicked
        sendBtn.addEventListener('click', () => {
            sendMessage();
        });
        
        // Send message when Enter key is pressed
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                // Add user message to chat
                addMessageToChat('user', message);
                
                // Clear input
                chatInput.value = '';
                
                // Show typing indicator
                const typingIndicator = document.createElement('div');
                typingIndicator.classList.add('message', 'assistant', 'typing-indicator');
                typingIndicator.innerHTML = '<span></span><span></span><span></span>';
                chatMessages.appendChild(typingIndicator);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Call API to get assistant response
                fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        lang: currentLang,
                        session_id: sessionId,
                        user_info: userInfo
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    // Remove typing indicator
                    const indicator = chatMessages.querySelector('.typing-indicator');
                    if (indicator) {
                        chatMessages.removeChild(indicator);
                    }
                    
                    // Add assistant response to chat
                    addMessageToChat('assistant', data.response);
                    
                    // Update user info if contact was saved
                    if (data.contact_saved) {
                        console.log('Contact saved:', data.detected_info);
                        userInfo = { ...userInfo, ...data.detected_info };
                        localStorage.setItem('alligator_user_info', JSON.stringify(userInfo));
                    }
                    
                    // Update session ID
                    if (data.session_id) {
                        sessionId = data.session_id;
                        localStorage.setItem('alligator_session_id', sessionId);
                    }
                })
                .catch(error => {
                    // Remove typing indicator
                    const indicator = chatMessages.querySelector('.typing-indicator');
                    if (indicator) {
                        chatMessages.removeChild(indicator);
                    }
                    
                    // Add error message
                    addMessageToChat('assistant', 'Sorry, I encountered an error. Please try again later.');
                    console.error('Error:', error);
                });
            }
        }
        
        function addMessageToChat(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', role);
            messageDiv.innerHTML = content.replace(/\n/g, '<br>');
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Function to update UI text based on selected language
        function updateUILanguage(lang, welcomeMessage) {
            // Get translations for the selected language
            const trans = translations[lang];
            if (!trans) return;
            
            // Update page title
            document.querySelector('.tagline').textContent = trans.title;
            document.querySelector('.subtitle').textContent = trans.subtitle;
            
            // Update chat placeholder
            document.querySelector('.chat-input input').placeholder = trans.input_placeholder;
            
            // Update chat welcome message
            const welcomeEl = document.querySelector('.chat-messages .message.assistant');
            if (welcomeEl) {
                welcomeEl.innerHTML = welcomeMessage.replace(/\n/g, '<br>');
            }
            
            // Update chat header
            if (trans.chat_header) {
                const headerTitle = document.querySelector('.chat-header-title');
                const headerStatus = document.querySelector('.chat-header-status');
                
                if (headerTitle) headerTitle.textContent = trans.chat_header.title;
                if (headerStatus) headerStatus.textContent = trans.chat_header.status;
            }
            
            // Update chat intro
            if (trans.chat_intro) {
                const introTitle = document.querySelector('.chat-intro-title');
                const introDesc = document.querySelector('.chat-intro-description');
                
                if (introTitle) introTitle.textContent = trans.chat_intro.title;
                if (introDesc) introDesc.textContent = trans.chat_intro.description;
            }
            
            // Update features
            if (trans.features) {
                const featureDestinations = document.querySelector('.feature-destinations');
                const featureLanguages = document.querySelector('.feature-languages');
                const featureItineraries = document.querySelector('.feature-itineraries');
                const featureAvailability = document.querySelector('.feature-availability');
                
                if (featureDestinations) featureDestinations.textContent = trans.features.destinations;
                if (featureLanguages) featureLanguages.textContent = trans.features.languages;
                if (featureItineraries) featureItineraries.textContent = trans.features.itineraries;
                if (featureAvailability) featureAvailability.textContent = trans.features.availability;
            }
            
            // Update navigation
            if (trans.main_nav) {
                const navItems = document.querySelectorAll('.main-nav a');
                if (navItems.length >= 3) {
                    navItems[0].textContent = trans.main_nav.chat;
                    navItems[1].textContent = trans.main_nav.destinations;
                    navItems[2].textContent = trans.main_nav.about;
                }
            }
            
            // Update popular destinations heading if it exists
            const destinationsHeading = document.querySelector('.destinations-heading');
            if (destinationsHeading && trans.popular_destinations) {
                destinationsHeading.textContent = trans.popular_destinations;
            }
            
            // Update destinations description if it exists
            const destinationsDesc = document.querySelector('.destinations-description');
            if (destinationsDesc && trans.destinations_description) {
                destinationsDesc.textContent = trans.destinations_description;
            }
            
            // Update sidebar title if it exists
            const sidebarTitle = document.querySelector('.sidebar-title');
            if (sidebarTitle && trans.sidebar_title) {
                sidebarTitle.textContent = trans.sidebar_title;
            }
            
            // Update call to action button if it exists
            const ctaButton = document.querySelector('.cta-button');
            if (ctaButton && trans.call_to_action) {
                ctaButton.textContent = trans.call_to_action;
            }
            
            // Update destinations and CTA content
            updateDestinationsAndCTA(lang);
        }
        
        // Function to update destinations and CTA content
        function updateDestinationsAndCTA(lang) {
            const trans = translations[lang];
            if (!trans || !trans.destinations || !trans.cta) return;
            
            // Update Bali card
            const baliTitle = document.querySelector('.destination-card:nth-child(1) .destination-title');
            const baliDesc = document.querySelector('.destination-card:nth-child(1) .destination-desc');
            const baliBestTime = document.querySelector('.destination-card:nth-child(1) .best-time span');
            const baliExplore = document.querySelector('.destination-card:nth-child(1) .explore-btn span');
            
            if (baliTitle) baliTitle.textContent = trans.destinations.bali.name;
            if (baliDesc) baliDesc.textContent = trans.destinations.bali.description;
            if (baliBestTime) baliBestTime.textContent = trans.destinations.bali.best_time;
            if (baliExplore) baliExplore.textContent = trans.destinations.bali.explore;
            
            // Update Barcelona card
            const barcelonaTitle = document.querySelector('.destination-card:nth-child(2) .destination-title');
            const barcelonaDesc = document.querySelector('.destination-card:nth-child(2) .destination-desc');
            const barcelonaBestTime = document.querySelector('.destination-card:nth-child(2) .best-time span');
            const barcelonaExplore = document.querySelector('.destination-card:nth-child(2) .explore-btn span');
            
            if (barcelonaTitle) barcelonaTitle.textContent = trans.destinations.barcelona.name;
            if (barcelonaDesc) barcelonaDesc.textContent = trans.destinations.barcelona.description;
            if (barcelonaBestTime) barcelonaBestTime.textContent = trans.destinations.barcelona.best_time;
            if (barcelonaExplore) barcelonaExplore.textContent = trans.destinations.barcelona.explore;
            
            // Update Tokyo card
            const tokyoTitle = document.querySelector('.destination-card:nth-child(3) .destination-title');
            const tokyoDesc = document.querySelector('.destination-card:nth-child(3) .destination-desc');
            const tokyoBestTime = document.querySelector('.destination-card:nth-child(3) .best-time span');
            const tokyoExplore = document.querySelector('.destination-card:nth-child(3) .explore-btn span');
            
            if (tokyoTitle) tokyoTitle.textContent = trans.destinations.tokyo.name;
            if (tokyoDesc) tokyoDesc.textContent = trans.destinations.tokyo.description;
            if (tokyoBestTime) tokyoBestTime.textContent = trans.destinations.tokyo.best_time;
            if (tokyoExplore) tokyoExplore.textContent = trans.destinations.tokyo.explore;
            
            // Update CTA section
            const ctaTitle = document.querySelector('.cta-section h2');
            const ctaDesc = document.querySelector('.cta-section p');
            const ctaContact = document.querySelector('.cta-section .btn:first-child');
            const ctaPackages = document.querySelector('.cta-section .btn:last-child');
            
            if (ctaTitle) ctaTitle.textContent = trans.cta.title;
            if (ctaDesc) ctaDesc.textContent = trans.cta.description;
            if (ctaContact) ctaContact.textContent = trans.cta.contact;
            if (ctaPackages) ctaPackages.textContent = trans.cta.view_packages;
        }

        // Handle destination click events
        document.querySelectorAll('.destination-card').forEach(card => {
            card.addEventListener('click', function() {
                const destinationName = this.querySelector('.destination-title').textContent;
                // Use translated queries based on current language
                if (currentLang === 'uk') {
                    chatInput.value = `Розкажіть мені більше про ${destinationName}`;
                } else if (currentLang === 'ru') {
                    chatInput.value = `Расскажите мне больше о ${destinationName}`;
                } else if (currentLang === 'de') {
                    chatInput.value = `Erzähle mir mehr über ${destinationName}`;
                } else if (currentLang === 'ro') {
                    chatInput.value = `Spune-mi mai multe despre ${destinationName}`;
                } else {
                    chatInput.value = `Tell me more about ${destinationName}`;
                }
                sendMessage();
                
                // Scroll to chat
                document.querySelector('.chat-container').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            });
        });

        // Make destination cards keyboard accessible
        document.querySelectorAll('.explore-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation(); // Stop event from bubbling to card
                const card = this.closest('.destination-card');
                const destinationName = card.querySelector('.destination-title').textContent;
                
                // Use translated queries based on current language
                if (currentLang === 'uk') {
                    chatInput.value = `Розкажіть мені більше про ${destinationName}`;
                } else if (currentLang === 'ru') {
                    chatInput.value = `Расскажите мне больше о ${destinationName}`;
                } else if (currentLang === 'de') {
                    chatInput.value = `Erzähle mir mehr über ${destinationName}`;
                } else if (currentLang === 'ro') {
                    chatInput.value = `Spune-mi mai multe despre ${destinationName}`;
                } else {
                    chatInput.value = `Tell me more about ${destinationName}`;
                }
                sendMessage();
                
                // Scroll to chat
                document.querySelector('.chat-container').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            });
            
            btn.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    // Trigger the click event on the button itself
                    this.click();
                }
            });
        });
        
        // Initialize chatbot with example queries
        const exampleQueriesEn = [
            "What's the best time to visit Bali?",
            "Recommend me a budget-friendly destination in Europe",
            "What documents do I need for traveling to Japan?",
            "Tell me about family-friendly activities in Barcelona"
        ];
        
        const exampleQueriesUk = [
            "Який найкращий час для відвідування Балі?",
            "Порекомендуйте бюджетний напрямок у Європі",
            "Які документи потрібні для подорожі до Японії?",
            "Розкажіть про сімейні розваги в Барселоні"
        ];
        
        const exampleQueriesRu = [
            "Какое лучшее время для посещения Бали?",
            "Порекомендуйте бюджетное направление в Европе",
            "Какие документы нужны для путешествия в Японию?",
            "Расскажите о семейных развлечениях в Барселоне"
        ];
        
        const exampleQueriesDe = [
            "Was ist die beste Reisezeit für Bali?",
            "Empfehlen Sie mir ein günstiges Reiseziel in Europa",
            "Welche Dokumente benötige ich für eine Reise nach Japan?",
            "Erzählen Sie mir über familienfreundliche Aktivitäten in Barcelona"
        ];
        
        const exampleQueriesRo = [
            "Care este cel mai bun moment pentru a vizita Bali?",
            "Recomandă-mi o destinație accesibilă în Europa",
            "Ce documente am nevoie pentru a călători în Japonia?",
            "Spune-mi despre activități pentru familii în Barcelona"
        ];
        
        // Add example queries to chat input placeholder
        let currentPlaceholderIndex = 0;
        function rotatePlaceholders() {
            let exampleQueries;
            
            // Select the appropriate language queries
            if (currentLang === 'uk') {
                exampleQueries = exampleQueriesUk;
            } else if (currentLang === 'ru') {
                exampleQueries = exampleQueriesRu;
            } else if (currentLang === 'de') {
                exampleQueries = exampleQueriesDe;
            } else if (currentLang === 'ro') {
                exampleQueries = exampleQueriesRo;
            } else {
                exampleQueries = exampleQueriesEn;
            }
            
            chatInput.setAttribute('placeholder', exampleQueries[currentPlaceholderIndex]);
            currentPlaceholderIndex = (currentPlaceholderIndex + 1) % exampleQueries.length;
        }
        
        // Change placeholder every 5 seconds
        setInterval(rotatePlaceholders, 5000);
        
        // Ensure the initial placeholder is in the current language
        currentPlaceholderIndex = 0;
        rotatePlaceholders();
    </script>
</body>
</html>